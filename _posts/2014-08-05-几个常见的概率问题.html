---
layout: post
title: "几个常见的概率问题"
category: "算法"
---

<div style="line-height: 1.5; color: #2c3f51;">
<div></div>
<div>
</div><div>

<p style="margin: 0 0 1.1em;"></p>
<div><div><div>
<ul style="margin-top: 0; margin-bottom: 15px; list-style-type: none;">
<li><a style="background: transparent; color: #1980e6; text-decoration: none;">几个常见的概率问题</a><ul style="margin-top: 0; margin-bottom: 15px; list-style-type: none;">
<li><a style="background: transparent; color: #1980e6; text-decoration: none;">1. 洗牌</a></li>
<li><a style="background: transparent; color: #1980e6; text-decoration: none;">2. 随机数生成器的转换</a></li>
<li><a style="background: transparent; color: #1980e6; text-decoration: none;">3. 蓄水池抽样</a></li>
<li><a style="background: transparent; color: #1980e6; text-decoration: none;">4. 参考</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<p style="margin: 0 0 1.1em;">今天研究了下几个简单的概率问题，在这里记录下。</p></div><div>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 2.15em; margin: 1.2em 0; text-align: start;">1. 洗牌</h2>
<p style="margin: 0 0 1.1em;">问题很简单，有 n 个元素，设计一个能保证随机性的洗牌算法。</p>
<p style="margin: 0 0 1.1em;">直觉想到的算法是：</p>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-size: 1em; font-weight: 300; line-height: 1.45; margin-bottom: 0;">用一个数组作为新牌堆，不停地从原数组剩下的元素中随机挑一个放入新牌堆，直到原牌堆耗尽。</p>
</blockquote>
<p style="margin: 0 0 1.1em;">我们来验证一下它的随机性。考虑一个元素，洗牌后它在第一个位置（即第一次抽牌就选中它）的概率是:</p>
</div><div>
<p style="margin: 0 0 1.1em;"></p><div><div style="text-align: center; margin: 1em 0; position: relative; display: block; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%;"><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="35" longdesc="__SVG__49861a1362f5d29a2d04fee3fa4762e8" name="0cc0ca94-22d0-4dd1-aeb4-006a7a5a05f4" src="/assets/img/3f17656b5cb9a1ea355e0e7d4b423a8b" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="14.875"/></span></span></div></div><p style="margin: 0 0 1.1em;"></p>
<p style="margin: 0 0 1.1em;">在第二个位置的概率是：</p>
</div><div>
<p style="margin: 0 0 1.1em;"></p><div><div style="text-align: center; margin: 1em 0; position: relative; display: block; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%;"><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="105" longdesc="__SVG__9ff3203a664f125fc3346c37e86ffdb8" name="55b5a2e1-9b0c-4672-a73d-23afa1a562ba" src="/assets/img/475c80801a60fc5e09d937b6f1afe68e" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="276.5"/></span></span></div></div><p style="margin: 0 0 1.1em;"></p>
<p style="margin: 0 0 1.1em;">依次类推，可知该元素将被等概率地分配到任意位置，符合要求。</p>
<p style="margin: 0 0 1.1em;">按该思路实现洗牌算法时有两个问题。首先，新牌堆显然需要 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="14.875" longdesc="__SVG__1f08ccc9cd7309ba1e756c3d9345ad9f" name="731ea3a8-2f6c-4166-9cce-0afdbe522373" src="/assets/img/18802eaff9aa0dd3d392e4efa69dde7c" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="32.375"/></span></span></span> 的空间；其次，元素从旧数组移入新牌堆后势必会留下空洞，在后续抽牌时要跳过这些空洞位置。</p>
<p style="margin: 0 0 1.1em;">但实际上，新牌堆和旧牌堆元素之和始终为 n，因此整个洗牌过程可以就地完成。<strong style="font-weight: bold;">我们可以从前向后遍历，对元素 i，前 i-1 个位置构成新牌堆，i 及其后续元素属于旧牌堆。从旧牌堆中随机抽一个元素，与 i 处元素交换，即完成了一次抽牌动作</strong>：</p>
<p style="margin: 0 0 1.1em;"><img alt="Alt text" class="en-media" longdesc="./1407165876987.png" name="7181a84e-10b9-436c-a70f-45240438418a" src="/assets/img/1a87c760b2ed0738a84555935ac5928d.png" style="border: 0; vertical-align: middle; max-width: 100%;" title=""/></p>
<p style="margin: 0 0 1.1em;">这个算法还有个名字，<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Fisher–Yates shuffle</code>。</p>
<p style="margin: 0 0 1.1em;">代码：</p>
</div><div>
<pre style="font-family: Source Code Pro,monospace; font-size: .9em; white-space: pre-wrap; display: block; padding: 2px; margin: 0 0 1.1em; line-height: 1.45; word-break: break-word; word-wrap: break-word; color: #333; background-color: rgba(102,128,153,0.05); border: 0; border-radius: 5px; text-align: start; background: #f6f6f6;" xml:space="preserve"><code style="font-family: Source Code Pro,monospace; font-size: inherit; padding: 18px 28px; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f;"><span style="color: #f92672;"><span style="color: #66d9ef;">function</span> <span style="color: #a6e22e;">shuffle</span><span style="color: #f8f8f2;">(array)</span> </span>{
  <span style="color: #f92672;">var</span> m = <span style="color: #f92672;">array</span>.length, i;

  <span style="color: #75715e;">// While there remain elements to shuffle…</span>
  <span style="color: #75715e;">// 为了方便这里是从后往前遍历的</span>
  <span style="color: #f92672;">while</span> (m) {

    <span style="color: #75715e;">// Pick a remaining element…</span>
    i = Math.floor(Math.random() * m--);

    <span style="color: #75715e;">// And swap it with the current element.</span>
    <span style="color: #f92672;">var</span> t = <span style="color: #f92672;">array</span>[m];
    <span style="color: #f92672;">array</span>[m] = <span style="color: #f92672;">array</span>[i];
    <span style="color: #f92672;">array</span>[i] = t;
  }

}</code></pre>
</div><div>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 2.15em; margin: 1.2em 0; text-align: start;">2. 随机数生成器的转换</h2>
<p style="margin: 0 0 1.1em;">听名字有点绕，其实就是给你一个<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand5()</code>，表示随机生成 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="15.75" longdesc="__SVG__e436fc771d3f29fa0eb7504061b620c4" name="b02ef188-8fe1-4fd8-969d-b4f1a27259e3" src="/assets/img/8d5b6842f6dda1004a7f76cb1a08cfa3" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="35"/></span></span></span> 之间的数字，让你实现一个<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand3()</code>。</p>
</div><div>
<pre style="font-family: Source Code Pro,monospace; font-size: .9em; white-space: pre-wrap; display: block; padding: 2px; margin: 0 0 1.1em; line-height: 1.45; word-break: break-word; word-wrap: break-word; color: #333; background-color: rgba(102,128,153,0.05); border: 0; border-radius: 5px; text-align: start; background: #f6f6f6;" xml:space="preserve"><code style="font-family: Source Code Pro,monospace; font-size: inherit; padding: 18px 28px; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f;"><span style="color: #f92672;"><span style="color: #66d9ef;">int</span> <span style="color: #a6e22e;">Rand3</span><span style="color: #f8f8f2;">()</span>  
</span>{  
    <span style="color: #f92672;">int</span> x = <span style="color: #ae81ff;">5</span>;  
    <span style="color: #f92672;">while</span>(x &gt;= <span style="color: #ae81ff;">3</span>) 
        x = Rand5();  
    <span style="color: #f92672;">return</span> x;  
}  </code></pre>
<p style="margin: 0 0 1.1em;">逻辑很简单，用<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand5()</code>不停地产生随机数，直到某个数字落在了 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="14.875" longdesc="__SVG__fe309a23016755cc5ed88917878b89e5" name="5db14838-9a04-4dc0-8081-37043d87d364" src="/assets/img/2f0a5b4bcc0f342409b531cbcb0a9f5f" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="35"/></span></span></span> 内。最终只会生成 0/1/2 三个数字，看起来似乎每个数字都是等概率的。下面来证明这个结论：</p>
<p style="margin: 0 0 1.1em;">以输出0为例，看看概率是多少。第一次 Rand5 返回 0 的概率是1/5，如果返回3或4（2/5 的概率），则需要调用第二次，同样的，也是1/5的概率得到 0，2/5 的概率得到3或4导致循环继续执行下去，如此反复。因此输出 0 的概率为：</p>
</div><div>
<p style="margin: 0 0 1.1em;"></p><div><div style="text-align: center; margin: 1em 0; position: relative; display: block; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%;"><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="232.75" longdesc="__SVG__5c819d4e1f08a54a7466b5dbef22b276" name="03a6ca71-14e3-4420-b77b-c9ce2cc95f89" src="/assets/img/0beca4bfb94ae7df66d05986a90c919f" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="347.375"/></span></span></div></div><p style="margin: 0 0 1.1em;"></p>
<p style="margin: 0 0 1.1em;">显然这种方法是正确的。</p>
<p style="margin: 0 0 1.1em;">换一下题目，给一个<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand(3)</code>，怎么生成一个<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand(5)</code>呢？由于 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="15.75" longdesc="__SVG__230b150b8ff4d4a5ba4929aac2121d0b" name="89771610-6621-4143-91c1-23ebeee87ff1" src="/assets/img/1310a224d6a91503152b0a32587e51e8" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="158.375"/></span></span></span> 可以构造出<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand(9)</code>，对它再应用上述算法即可。</p>
<p style="margin: 0 0 1.1em;">解释下 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="15.75" longdesc="__SVG__230b150b8ff4d4a5ba4929aac2121d0b" name="89771610-6621-4143-91c1-23ebeee87ff1" src="/assets/img/1310a224d6a91503152b0a32587e51e8" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="158.375"/></span></span></span> 为什么可以得到<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">Rand(9)</code>。<span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="15.75" longdesc="__SVG__825626ce6bb0c94b65351efbb1357981" name="1c1a7f52-b4fd-47f9-8d84-95d88e850ab0" src="/assets/img/0b10345541f4ba83287023ef0a94cedb" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="83.125"/></span></span></span> 得到一个随机数集合<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">0,3,6</code>，<span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="15.75" longdesc="__SVG__7bfd91c8c1dd640ac5432fbc6ec23b3c" name="8a47089a-a08b-4f12-899b-1f2ab70cd46a" src="/assets/img/4acd4692dcc6e04b8c438e5a42be0071" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="56"/></span></span></span> 得到<code style="font-family: Source Code Pro,monospace; font-size: .9em; padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px;">0,1,2</code>，二者相加的结果刚好均匀地分布在 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="14.875" longdesc="__SVG__e17cbf8e7f67a536eb6e05e56fba7504" name="ed211632-e20c-4d52-a261-74098970aea0" src="/assets/img/b1cf8ee045f54d9f9c44448362a5cab0" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="35"/></span></span></span> 区间内。推广这个结论可得，<span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="15.75" longdesc="__SVG__854c312b08598f30777baa4e8fe990d2" name="5700aeb1-932d-4c8c-a765-f8cdbe0bab8e" src="/assets/img/c2cc10c2730ccc0fb323b9e868ac87da" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="176.75"/></span></span></span> 可以得到 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="18.375" longdesc="__SVG__0a8c394c2270f3d2f72293343eecc339" name="8b132115-bf89-462b-8613-262a9767841a" src="/assets/img/4560cdb5e85b30a0cfe28c4f7a9e01c5" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="49.875"/></span></span></span> 区间内的随机数生成器。</p>
</div><div>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 2.15em; margin: 1.2em 0; text-align: start;">3. 蓄水池抽样</h2>
<p style="margin: 0 0 1.1em;">蓄水池抽样是要解决这样一个问题：给定一个很大的集合，集合总数 n 不能确定，只能遍历一遍，要求从中随机选取 k 个元素。</p>
<p style="margin: 0 0 1.1em;">蓄水池算法的原理是：维护一个大小为 k 的蓄水池，用集合的前 k 个元素初始化之；对后续每个元素 i，都以 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="22.75" longdesc="__SVG__58293d9bb655e706895b6320fb510e16" name="e8c433ed-516f-4600-a2a0-987ec24ad424" src="/assets/img/da289e1c201e66cc838e6a9a02476c14" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="11.375"/></span></span></span> 的概率替换掉蓄水池中的某个元素。</p>
<p style="margin: 0 0 1.1em;">代码：</p>
</div><div>
<pre style="font-family: Source Code Pro,monospace; font-size: .9em; white-space: pre-wrap; display: block; padding: 2px; margin: 0 0 1.1em; line-height: 1.45; word-break: break-word; word-wrap: break-word; color: #333; background-color: rgba(102,128,153,0.05); border: 0; border-radius: 5px; text-align: start; background: #f6f6f6;" xml:space="preserve"><code style="font-family: Source Code Pro,monospace; font-size: inherit; padding: 18px 28px; color: #f8f8f2; background-color: transparent; white-space: pre-wrap; border-radius: 0; display: block; background: #23241f;">Init : <span>a</span> reservoir <span>with</span> <span>the</span> size： k  
<span style="color: #f92672;">for</span> i= k+<span style="color: #ae81ff;">1</span> <span style="color: #e6db74;">to</span> n  
   M=<span style="color: #e6db74;">random</span>(<span style="color: #ae81ff;">1</span>, i);  
   <span style="color: #f92672;">if</span>( M &lt; k)  
        SWAP <span>the</span> Mth <span style="color: #e6db74;">value</span> <span>and</span> ith <span style="color: #e6db74;">value</span>  
<span style="color: #f92672;"><span style="color: #66d9ef;">end</span> <span style="color: #a6e22e;">for</span>  </span></code></pre>
<p style="margin: 0 0 1.1em;">下面来证明一下该算法的正确性。</p>
<p style="margin: 0 0 1.1em;">对某个元素，第一次就选中它的概率是 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="21.875" longdesc="__SVG__179b80cc86f52ed7205e115c2a3ddc1b" name="e8308607-1a09-4761-8f35-a857eb82298b" src="/assets/img/0ea1513cd57dbc7f585b3d6dbe0a5fde" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="12.25"/></span></span></span>，第二次才选中它的概率是 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="22.75" longdesc="__SVG__3ed767005f8cf83b745a833a73774968" name="ea74d573-f3b0-45a2-b316-c31f2b8cb7ac" src="/assets/img/fa7c2c689e4729716d097b6f67790cfa" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="128.625"/></span></span></span>，第三次第四次也类似，这跟之前的洗牌场景很像。因此，最终该元素被选中的概率就等于 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="21.875" longdesc="__SVG__b2501e99a0ce9442ccfed26d372bbd24" name="739ad5e1-6f1e-45b6-9e85-572738de6731" src="/assets/img/3fd31a581f6f8a25112896b4b4db0bd6" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="12.25"/></span></span></span>。</p>
<ol style="margin-top: 0; margin-bottom: 1.1em;"><li>当 n == k 时，每个元素出现在蓄水池的概率都是1，即 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="22.75" longdesc="__SVG__11d2f43ebfc69c2d1cb6e1d0b6f10e08" name="7e0df589-865d-47c6-a37c-cb9fa6011916" src="/assets/img/0c96e507b7940337f552d0ea3af6299d" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="11.375"/></span></span></span>；</li>
<li><p style="margin: 0 0 1.1em;">当 n == k+1 时，第一次考察发生在元素 k+1 处，根据算法，它被放入蓄水池的概率为 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="23.625" longdesc="__SVG__b72f313005ff581330fb54a0ab3c2166" name="72f6da18-6469-4055-84cf-4b2eddd53c5c" src="/assets/img/2ad4af9f1eabb23ee42ac3807b772864" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="25.375"/></span></span></span>；对原蓄水池中的任一元素，该次考察后被换出去的概率等于：</p>
<p style="margin: 0 0 1.1em;"></p><div><div style="text-align: center; margin: 1em 0; position: relative; display: block; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%;"><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="105.875" longdesc="__SVG__98e761e6999555665cc7466be80cbbb3" name="068ac8b3-0065-4d67-bf49-c940daab64d9" src="/assets/img/a85c57c8be70611b24f70a80575f386a" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="499.625"/></span></span></div></div><p style="margin: 0 0 1.1em;"></p>
<p style="margin: 0 0 1.1em;">所以，元素依然在蓄水池内的概率为 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="23.625" longdesc="__SVG__c94baee184698f33b8c47497ef4567db" name="76604338-e853-4dda-92d2-a79576435797" src="/assets/img/025327d6f9171ce2d2c76897e38ff021" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="224"/></span></span></span>。</p></li>
<li><p style="margin: 0 0 1.1em;">当 n == k+2 时，根据2，前 k+1 内的元素在第二次考察（即考察第 k+2 个元素）前在蓄水池内的概率为 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="23.625" longdesc="__SVG__b72f313005ff581330fb54a0ab3c2166" name="72f6da18-6469-4055-84cf-4b2eddd53c5c" src="/assets/img/2ad4af9f1eabb23ee42ac3807b772864" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="25.375"/></span></span></span>。</p>
<p style="margin: 0 0 1.1em;">同样的，第 k+2 个元素被放入蓄水池的概率为 <span><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="23.625" longdesc="__SVG__b77f0b654d7f8b3ec33ebf6c32049af9" name="67e1df3d-33da-4dc6-aafe-4190baee1555" src="/assets/img/8bb52020c5216b87e52c5efde38969dc" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="25.375"/></span></span></span>；</p>
<p style="margin: 0 0 1.1em;">对前 k+1 的元素，在第二次考察后在蓄水池要求 1)之前就在蓄水池；2)这次没有被交换出去： <br/>
</p><div><div style="text-align: center; margin: 1em 0; position: relative; display: block; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%;"><span style="font-size: 100%; display: inline-block; font-style: normal; font-weight: normal; line-height: normal; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0; vertical-align: middle;"><span><img class="en-media" height="176.75" longdesc="__SVG__96df200743c7e2d899a90510b83eacdd" name="e73d0ba1-39d7-45e4-ad51-87df0cd03393" src="/assets/img/98099a39d68c6dbf4895a6d91c019aed" style="margin-top: 0; margin-bottom: 0; border: 0; vertical-align: middle; max-width: 100%;" width="465.5"/></span></span></div></div>
也符合条件。<p style="margin: 0 0 1.1em;"></p></li>
<li><p style="margin: 0 0 1.1em;">推广上述过程即可得证。</p></li>
</ol>
</div><div>
<h2 style="font-family: inherit; font-weight: bold; line-height: 1.1; color: inherit; margin-top: 21px; margin-bottom: 10.5px; font-size: 2.15em; margin: 1.2em 0; text-align: start;">4. 参考</h2>
<ol style="margin-top: 0; margin-bottom: 1.1em;"><li><a href="http://bost.ocks.org/mike/shuffle/" style="background: transparent; color: #1980e6; text-decoration: none;" target="_blank">Fisher–Yates Shuffle</a></li>
<li><a href="http://www.gocalf.com/blog/build-rand3-from-rand5.html" style="background: transparent; color: #1980e6; text-decoration: none;" target="_blank">利用等概率Rand5产生等概率Rand3</a></li>
<li><a href="http://blog.csdn.net/hackbuteer1/article/details/7971328" style="background: transparent; color: #1980e6; text-decoration: none;" target="_blank">海量数据随机抽样问题（蓄水池问题）</a></li>
</ol></div><div></div></div>